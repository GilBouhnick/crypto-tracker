<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Tracker - Live Technical Analysis</title>
    <style>
        th:not(:nth-child(1)):not(:nth-child(2)) {
            cursor: pointer;
            user-select: none;
        }

        th:not(:nth-child(1)):not(:nth-child(2)):hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 20px 10px;
            background-color: #f8f9fa;
            overflow-x: hidden;
            width: 100%;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            overflow: visible;
            padding: 0;
        }

        h1 {
            color: #1a1a1a;
            margin-bottom: 30px;
        }

        .crypto-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            min-width: 1200px;
        }

        .crypto-table th,
        .crypto-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .crypto-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #666;
        }

        .name-cell {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 160px;
        }

        .name-cell img {
            width: 24px;
            height: 24px;
        }

        .symbol {
            color: #666;
            margin-left: 6px;
        }

        .positive {
            color: #16c784;
        }

        .negative {
            color: #ea3943;
        }

        .crypto-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        th:not(:nth-child(1)) {
            position: relative;
        }

        th.th-sort-asc,
        th.th-sort-desc {
            background-color: rgba(0, 0, 0, 0.05);
        }

        th {
            transition: background-color 0.2s ease;
        }

        .technical-analysis {
            position: relative;
            cursor: pointer;
        }

        .indicator-details {
            position: relative;
            cursor: pointer;
        }

        .signal {
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.9em;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 70px;
            text-align: center;
        }

        .signal.bullish {
            background-color: rgba(22, 199, 132, 0.1);
            color: #16c784;
        }

        .signal.bearish {
            background-color: rgba(234, 57, 67, 0.1);
            color: #ea3943;
        }

        .signal.neutral {
            background-color: rgba(128, 128, 128, 0.1);
            color: #808080;
        }

        .technical-details-row {
            background-color: #f8f9fa;
            transition: all 0.3s ease;
        }

        .technical-details-container {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .technical-period {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .technical-period h3 {
            margin: 0 0 15px 0;
            font-size: 1.1em;
            color: #333;
        }

        .details-content {
            font-size: 0.9em;
        }

        .tooltip-section {
            background: white;
            margin-bottom: 16px;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .tooltip-section h4 {
            margin: 0 0 12px 0;
            font-size: 1em;
            color: #333;
        }

        .indicator-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            margin: 8px 0;
            flex-wrap: nowrap;
        }

        .indicator-row .value-label {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-right: 8px;
        }

        .indicator-row .signal {
            flex-shrink: 0;
            min-width: 70px;
            text-align: center;
        }

        .summary {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }

        .summary h4 {
            margin: 0 0 5px 0;
        }

        .summary p {
            margin: 3px 0;
            font-size: 0.9em;
        }

        tr[data-symbol] {
            cursor: pointer;
        }

        tr[data-symbol]:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .tooltip {
            display: none;
            position: absolute;
            background: white;
            border: 1px solid #eee;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 1000;
            min-width: 200px;
            left: 50%;
            transform: translateX(-50%);
            top: 100%;
            margin-top: 5px;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .indicator-details:hover .tooltip {
            display: block;
        }

        .crypto-table th:last-child {
            min-width: 200px;
            position: relative;
        }

        .tooltip {
            width: 300px;
            padding: 15px;
        }

        .tooltip-section {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }

        .tooltip-section:last-child {
            border-bottom: none;
        }

        .tooltip h4 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 14px;
        }

        .indicator-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 4px 0;
        }

        .indicator-desc {
            margin: 4px 0;
            font-size: 12px;
            color: #666;
            font-style: italic;
        }

        .tooltip .signal {
            font-size: 11px;
            padding: 2px 6px;
        }

        .tooltip-section.summary {
            background-color: #f8f9fa;
            margin: 8px -15px -15px -15px;
            padding: 10px 15px;
            border-radius: 0 0 4px 4px;
        }

        .tooltip-section.summary p {
            margin: 4px 0;
            font-size: 13px;
        }

        .table-wrapper {
            width: 100%;
            overflow-x: auto;
            position: relative;
            -webkit-overflow-scrolling: touch;
            max-width: 100vw;
            margin: 0 -10px;
            padding: 0 10px;
            display: block;
        }

        /* Make first column sticky */
        .crypto-table th:first-child,
        .crypto-table td:first-child {
            position: -webkit-sticky !important;
            position: sticky !important;
            left: 10px;
        }

        .crypto-table thead th:first-child {
            background: #f8f9fa;
            z-index: 3;
        }

        .crypto-table tbody td:first-child {
            background: white;
            z-index: 1;
        }

        /* Fix table header scrolling */
        .crypto-table thead {
            position: sticky;
            top: 0;
            z-index: 4;
            background: #f8f9fa;
        }

        .crypto-table thead th {
            position: sticky;
            top: 0;
            background: #f8f9fa;
            z-index: 4;
            border-bottom: 1px solid #eee;
        }

        /* Ensure first column stays fixed while scrolling */
        .crypto-table th:first-child,
        .crypto-table td:first-child {
            position: sticky;
            left: 0;
            background: #f8f9fa;
            z-index: 5;
            border-right: 1px solid #eee;
            box-shadow: 2px 0 4px rgba(0,0,0,0.1);
        }

        /* Higher z-index for the first header cell */
        .crypto-table thead th:first-child {
            z-index: 6;
            background: #f8f9fa;
        }

        /* Ensure proper background for cells */
        .crypto-table tbody td:first-child {
            background: white;
        }

        .crypto-table tbody tr:hover td:first-child {
            background: #f8f9fa;
        }

        /* Add horizontal padding to prevent content from touching the edges */
        .table-wrapper::before,
        .table-wrapper::after {
            content: '';
            position: sticky;
            width: 10px;
            height: 1px;
            z-index: 7;
        }

        .table-wrapper::before {
            left: 0;
        }

        .table-wrapper::after {
            right: 0;
        }

        tr[data-symbol].expanded {
            position: sticky;
            top: 0;
            background-color: white;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .technical-details-container {
                grid-template-columns: 1fr;
                padding: 10px;
                gap: 10px;
            }

            .technical-period {
                margin-bottom: 10px;
            }

            .technical-period h3 {
                font-size: 1em;
                padding: 10px;
                margin: -10px -10px 10px -10px;
                background-color: #f8f9fa;
                border-radius: 8px 8px 0 0;
            }

            .indicator-row {
                flex-direction: row;
                align-items: center;
                gap: 8px;
            }

            .indicator-row .signal {
                align-self: center;
            }

            .tooltip-section {
                padding: 10px;
                margin: -5px;
                border-radius: 4px;
            }

            .tooltip-section h4 {
                font-size: 0.9em;
                margin-bottom: 5px;
            }

            .indicator-desc {
                font-size: 0.8em;
                line-height: 1.4;
            }

            .summary {
                margin: 10px -5px -5px -5px;
                border-radius: 0 0 4px 4px;
            }

            .name-cell {
                min-width: 120px;
                gap: 8px;
            }

            .name-cell img {
                width: 20px;
                height: 20px;
            }

            .symbol {
                display: none;
            }

            .crypto-table th,
            .crypto-table td {
                padding: 12px;
            }
        }

        .technical-details-popup {
            display: none;
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            transform: translateY(100%);
            background: white;
            padding: 0;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
            z-index: 1001;
            width: 100%;
            max-width: 600px;
            height: 85vh;
            margin: 0 auto;
            flex-direction: column;
            transition: transform 0.3s ease-out;
            overflow: hidden;
        }

        .technical-details-popup.active {
            transform: translateY(0);
        }

        .technical-details-popup[style*="display: block"] {
            display: flex !important;
        }

        .popup-header {
            padding: 16px;
            background: white;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 2;
            border-radius: 20px 20px 0 0;
            min-height: 24px;
            flex-shrink: 0;
        }

        .popup-header h3 {
            margin: 0;
            font-size: 16px;
            color: #333;
            font-weight: 600;
        }

        .popup-content {
            flex: 1;
            overflow-y: scroll;
            -webkit-overflow-scrolling: touch;
            padding: 16px;
            overscroll-behavior: contain;
        }

        .summary-section {
            margin-bottom: 16px;
            padding: 0 0 16px 0;
            border-bottom: 1px solid #eee;
        }

        .overall-signal {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .signal-label {
            font-weight: 500;
            color: #333;
            font-size: 1em;
        }

        .signal-counts {
            display: flex;
            justify-content: space-between;
            gap: 24px;
        }

        .bullish-count,
        .bearish-count {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .count-label {
            color: #666;
            font-size: 0.9em;
        }

        .count {
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .signal-counts {
                flex-direction: row;
                gap: 16px;
            }

            .bullish-count,
            .bearish-count {
                flex: 1;
            }
        }

        .indicators-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding-bottom: 16px;
        }

        .close-button {
            background: none;
            border: none;
            padding: 8px;
            cursor: pointer;
            color: #666;
            font-size: 24px;
            line-height: 1;
            margin: -8px;
        }

        .close-button:hover {
            color: #333;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease-out;
        }

        .overlay.active {
            opacity: 1;
        }

        body.popup-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        .refresh-btn {
            padding: 8px 16px;
            background-color: #1a1a1a;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .refresh-btn:hover {
            background-color: #333;
        }
        
        .refresh-btn:disabled {
            background-color: #666;
            cursor: not-allowed;
        }

        /* Add webkit prefix for better Safari support */
        @media screen and (-webkit-min-device-pixel-ratio:0) {
            .table-wrapper {
                -webkit-transform: translateZ(0);
                transform: translateZ(0);
            }
        }
    </style>
</head>
<body>
    <div class="crypto-wrapper" style="width: 100%; max-width: 100%; overflow-x: hidden;">
        <div class="container">
            <h1>The List</h1>
            <div style="margin-bottom: 20px">
                <button id="refreshButton" class="refresh-btn">
                    Refresh Data
                </button>
                <span id="lastUpdate" style="margin-left: 10px; color: #666;">
                </span>
            </div>
            <div class="table-wrapper">
                <table class="crypto-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Price</th>
                            <th>1h</th>
                            <th>24h</th>
                            <th>7d</th>
                            <th>30d</th>
                            <th>90d</th>
                            <th>1h TA</th>
                            <th>Short</th>
                            <th>Mid</th>
                            <th>Long</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr data-symbol="BTCUSDT">
                            <td class="name-cell">
                                <img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png" alt="Bitcoin">
                                Bitcoin <span class="symbol">BTC</span>
                            </td>
                            <td class="price">Loading...</td>
                            <td class="change-1h">-</td>
                            <td class="change-24h">-</td>
                            <td class="change-7d">-</td>
                            <td class="change-30d">-</td>
                            <td class="change-90d">-</td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="1h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="24h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="7d">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="30d">Loading...</div>
                            </td>
                        </tr>
                        <tr class="technical-details-row" data-symbol="BTCUSDT-details" style="display: none;">
                            <td colspan="11">
                                <div class="technical-details-container">
                                    <div class="technical-period" data-period="24h">
                                        <h3>Short Term (24h)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="7d">
                                        <h3>Mid Term (7d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="30d">
                                        <h3>Long Term (30d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-symbol="ETHUSDT">
                            <td class="name-cell">
                                <img src="https://cryptologos.cc/logos/ethereum-eth-logo.png" alt="Ethereum">
                                Ethereum <span class="symbol">ETH</span>
                            </td>
                            <td class="price">Loading...</td>
                            <td class="change-1h">-</td>
                            <td class="change-24h">-</td>
                            <td class="change-7d">-</td>
                            <td class="change-30d">-</td>
                            <td class="change-90d">-</td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="1h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="24h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="7d">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="30d">Loading...</div>
                            </td>
                        </tr>
                        <tr class="technical-details-row" data-symbol="ETHUSDT-details" style="display: none;">
                            <td colspan="11">
                                <div class="technical-details-container">
                                    <div class="technical-period" data-period="24h">
                                        <h3>Short Term (24h)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="7d">
                                        <h3>Mid Term (7d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="30d">
                                        <h3>Long Term (30d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-symbol="BNBUSDT">
                            <td class="name-cell">
                                <img src="https://cryptologos.cc/logos/bnb-bnb-logo.png" alt="BNB">
                                BNB <span class="symbol">BNB</span>
                            </td>
                            <td class="price">Loading...</td>
                            <td class="change-1h">-</td>
                            <td class="change-24h">-</td>
                            <td class="change-7d">-</td>
                            <td class="change-30d">-</td>
                            <td class="change-90d">-</td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="1h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="24h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="7d">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="30d">Loading...</div>
                            </td>
                        </tr>
                        <tr class="technical-details-row" data-symbol="BNBUSDT-details" style="display: none;">
                            <td colspan="11">
                                <div class="technical-details-container">
                                    <div class="technical-period" data-period="24h">
                                        <h3>Short Term (24h)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="7d">
                                        <h3>Mid Term (7d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="30d">
                                        <h3>Long Term (30d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-symbol="SOLUSDT">
                            <td class="name-cell">
                                <img src="https://cryptologos.cc/logos/solana-sol-logo.png" alt="Solana">
                                Solana <span class="symbol">SOL</span>
                            </td>
                            <td class="price">Loading...</td>
                            <td class="change-1h">-</td>
                            <td class="change-24h">-</td>
                            <td class="change-7d">-</td>
                            <td class="change-30d">-</td>
                            <td class="change-90d">-</td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="1h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="24h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="7d">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="30d">Loading...</div>
                            </td>
                        </tr>
                        <tr class="technical-details-row" data-symbol="SOLUSDT-details" style="display: none;">
                            <td colspan="11">
                                <div class="technical-details-container">
                                    <div class="technical-period" data-period="24h">
                                        <h3>Short Term (24h)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="7d">
                                        <h3>Mid Term (7d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="30d">
                                        <h3>Long Term (30d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-symbol="XRPUSDT">
                            <td class="name-cell">
                                <img src="https://cryptologos.cc/logos/xrp-xrp-logo.png" alt="XRP">
                                XRP <span class="symbol">XRP</span>
                            </td>
                            <td class="price">Loading...</td>
                            <td class="change-1h">-</td>
                            <td class="change-24h">-</td>
                            <td class="change-7d">-</td>
                            <td class="change-30d">-</td>
                            <td class="change-90d">-</td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="1h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="24h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="7d">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="30d">Loading...</div>
                            </td>
                        </tr>
                        <tr class="technical-details-row" data-symbol="XRPUSDT-details" style="display: none;">
                            <td colspan="11">
                                <div class="technical-details-container">
                                    <div class="technical-period" data-period="24h">
                                        <h3>Short Term (24h)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="7d">
                                        <h3>Mid Term (7d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="30d">
                                        <h3>Long Term (30d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-symbol="ADAUSDT">
                            <td class="name-cell">
                                <img src="https://cryptologos.cc/logos/cardano-ada-logo.png" alt="Cardano">
                                Cardano <span class="symbol">ADA</span>
                            </td>
                            <td class="price">Loading...</td>
                            <td class="change-1h">-</td>
                            <td class="change-24h">-</td>
                            <td class="change-7d">-</td>
                            <td class="change-30d">-</td>
                            <td class="change-90d">-</td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="1h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="24h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="7d">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="30d">Loading...</div>
                            </td>
                        </tr>
                        <tr class="technical-details-row" data-symbol="ADAUSDT-details" style="display: none;">
                            <td colspan="11">
                                <div class="technical-details-container">
                                    <div class="technical-period" data-period="24h">
                                        <h3>Short Term (24h)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="7d">
                                        <h3>Mid Term (7d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="30d">
                                        <h3>Long Term (30d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-symbol="DOGEUSDT">
                            <td class="name-cell">
                                <img src="https://cryptologos.cc/logos/dogecoin-doge-logo.png" alt="Dogecoin">
                                Dogecoin <span class="symbol">DOGE</span>
                            </td>
                            <td class="price">Loading...</td>
                            <td class="change-1h">-</td>
                            <td class="change-24h">-</td>
                            <td class="change-7d">-</td>
                            <td class="change-30d">-</td>
                            <td class="change-90d">-</td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="1h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="24h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="7d">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="30d">Loading...</div>
                            </td>
                        </tr>
                        <tr class="technical-details-row" data-symbol="DOGEUSDT-details" style="display: none;">
                            <td colspan="11">
                                <div class="technical-details-container">
                                    <div class="technical-period" data-period="24h">
                                        <h3>Short Term (24h)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="7d">
                                        <h3>Mid Term (7d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="30d">
                                        <h3>Long Term (30d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-symbol="AVAXUSDT">
                            <td class="name-cell">
                                <img src="https://cryptologos.cc/logos/avalanche-avax-logo.png" alt="Avalanche">
                                Avalanche <span class="symbol">AVAX</span>
                            </td>
                            <td class="price">Loading...</td>
                            <td class="change-1h">-</td>
                            <td class="change-24h">-</td>
                            <td class="change-7d">-</td>
                            <td class="change-30d">-</td>
                            <td class="change-90d">-</td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="1h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="24h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="7d">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="30d">Loading...</div>
                            </td>
                        </tr>
                        <tr class="technical-details-row" data-symbol="AVAXUSDT-details" style="display: none;">
                            <td colspan="11">
                                <div class="technical-details-container">
                                    <div class="technical-period" data-period="24h">
                                        <h3>Short Term (24h)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="7d">
                                        <h3>Mid Term (7d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="30d">
                                        <h3>Long Term (30d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-symbol="TRXUSDT">
                            <td class="name-cell">
                                <img src="https://cryptologos.cc/logos/tron-trx-logo.png" alt="TRON">
                                TRON <span class="symbol">TRX</span>
                            </td>
                            <td class="price">Loading...</td>
                            <td class="change-1h">-</td>
                            <td class="change-24h">-</td>
                            <td class="change-7d">-</td>
                            <td class="change-30d">-</td>
                            <td class="change-90d">-</td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="1h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="24h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="7d">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="30d">Loading...</div>
                            </td>
                        </tr>
                        <tr class="technical-details-row" data-symbol="TRXUSDT-details" style="display: none;">
                            <td colspan="11">
                                <div class="technical-details-container">
                                    <div class="technical-period" data-period="24h">
                                        <h3>Short Term (24h)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="7d">
                                        <h3>Mid Term (7d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="30d">
                                        <h3>Long Term (30d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-symbol="LINKUSDT">
                            <td class="name-cell">
                                <img src="https://cryptologos.cc/logos/chainlink-link-logo.png" alt="Chainlink">
                                Chainlink <span class="symbol">LINK</span>
                            </td>
                            <td class="price">Loading...</td>
                            <td class="change-1h">-</td>
                            <td class="change-24h">-</td>
                            <td class="change-7d">-</td>
                            <td class="change-30d">-</td>
                            <td class="change-90d">-</td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="1h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="24h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="7d">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="30d">Loading...</div>
                            </td>
                        </tr>
                        <tr class="technical-details-row" data-symbol="LINKUSDT-details" style="display: none;">
                            <td colspan="11">
                                <div class="technical-details-container">
                                    <div class="technical-period" data-period="24h">
                                        <h3>Short Term (24h)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="7d">
                                        <h3>Mid Term (7d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="30d">
                                        <h3>Long Term (30d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-symbol="MATICUSDT">
                            <td class="name-cell">
                                <img src="https://cryptologos.cc/logos/matic-network-matic-logo.png" alt="MATIC">
                                MATIC <span class="symbol">MATIC</span>
                            </td>
                            <td class="price">Loading...</td>
                            <td class="change-1h">-</td>
                            <td class="change-24h">-</td>
                            <td class="change-7d">-</td>
                            <td class="change-30d">-</td>
                            <td class="change-90d">-</td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="1h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="24h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="7d">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="30d">Loading...</div>
                            </td>
                        </tr>
                        <tr class="technical-details-row" data-symbol="MATICUSDT-details" style="display: none;">
                            <td colspan="11">
                                <div class="technical-details-container">
                                    <div class="technical-period" data-period="24h">
                                        <h3>Short Term (24h)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="7d">
                                        <h3>Mid Term (7d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="30d">
                                        <h3>Long Term (30d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-symbol="DOTUSDT">
                            <td class="name-cell">
                                <img src="https://cryptologos.cc/logos/polkadot-dot-logo.png" alt="DOT">
                                DOT <span class="symbol">DOT</span>
                            </td>
                            <td class="price">Loading...</td>
                            <td class="change-1h">-</td>
                            <td class="change-24h">-</td>
                            <td class="change-7d">-</td>
                            <td class="change-30d">-</td>
                            <td class="change-90d">-</td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="1h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="24h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="7d">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="30d">Loading...</div>
                            </td>
                        </tr>
                        <tr class="technical-details-row" data-symbol="DOTUSDT-details" style="display: none;">
                            <td colspan="11">
                                <div class="technical-details-container">
                                    <div class="technical-period" data-period="24h">
                                        <h3>Short Term (24h)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="7d">
                                        <h3>Mid Term (7d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="30d">
                                        <h3>Long Term (30d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-symbol="ATOMUSDT">
                            <td class="name-cell">
                                <img src="https://cryptologos.cc/logos/cosmos-atom-logo.png" alt="ATOM">
                                ATOM <span class="symbol">ATOM</span>
                            </td>
                            <td class="price">Loading...</td>
                            <td class="change-1h">-</td>
                            <td class="change-24h">-</td>
                            <td class="change-7d">-</td>
                            <td class="change-30d">-</td>
                            <td class="change-90d">-</td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="1h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="24h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="7d">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="30d">Loading...</div>
                            </td>
                        </tr>
                        <tr class="technical-details-row" data-symbol="ATOMUSDT-details" style="display: none;">
                            <td colspan="11">
                                <div class="technical-details-container">
                                    <div class="technical-period" data-period="24h">
                                        <h3>Short Term (24h)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="7d">
                                        <h3>Mid Term (7d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="30d">
                                        <h3>Long Term (30d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-symbol="LTCUSDT">
                            <td class="name-cell">
                                <img src="https://cryptologos.cc/logos/litecoin-ltc-logo.png" alt="LTC">
                                LTC <span class="symbol">LTC</span>
                            </td>
                            <td class="price">Loading...</td>
                            <td class="change-1h">-</td>
                            <td class="change-24h">-</td>
                            <td class="change-7d">-</td>
                            <td class="change-30d">-</td>
                            <td class="change-90d">-</td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="1h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="24h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="7d">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="30d">Loading...</div>
                            </td>
                        </tr>
                        <tr class="technical-details-row" data-symbol="LTCUSDT-details" style="display: none;">
                            <td colspan="11">
                                <div class="technical-details-container">
                                    <div class="technical-period" data-period="24h">
                                        <h3>Short Term (24h)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="7d">
                                        <h3>Mid Term (7d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="30d">
                                        <h3>Long Term (30d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-symbol="ICPUSDT">
                            <td class="name-cell">
                                <img src="https://cryptologos.cc/logos/internet-computer-icp-logo.png" alt="ICP">
                                ICP <span class="symbol">ICP</span>
                            </td>
                            <td class="price">Loading...</td>
                            <td class="change-1h">-</td>
                            <td class="change-24h">-</td>
                            <td class="change-7d">-</td>
                            <td class="change-30d">-</td>
                            <td class="change-90d">-</td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="1h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="24h">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="7d">Loading...</div>
                            </td>
                            <td class="technical-analysis">
                                <div class="indicator-details" data-period="30d">Loading...</div>
                            </td>
                        </tr>
                        <tr class="technical-details-row" data-symbol="ICPUSDT-details" style="display: none;">
                            <td colspan="11">
                                <div class="technical-details-container">
                                    <div class="technical-period" data-period="24h">
                                        <h3>Short Term (24h)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="7d">
                                        <h3>Mid Term (7d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                    <div class="technical-period" data-period="30d">
                                        <h3>Long Term (30d)</h3>
                                        <div class="details-content"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- Add similar rows for other tokens -->
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Add popup container -->
        <div class="overlay"></div>
        <div class="technical-details-popup">
            <div class="popup-header">
                <h3></h3>
                <button class="close-button">×</button>
            </div>
            <div class="popup-content"></div>
        </div>
    </div>
    <script>
        const symbols = [
            'BTCUSDT', 'ETHUSDT', 'BNBUSDT', 'SOLUSDT', 'XRPUSDT', 'ADAUSDT',
            'DOGEUSDT', 'AVAXUSDT', 'TRXUSDT', 'LINKUSDT', 'MATICUSDT', 'DOTUSDT',
            'ATOMUSDT', 'LTCUSDT', 'ICPUSDT'
        ];

        // Fetch current price and update the table
        async function fetchCurrentPrice(symbol) {
            try {
                // Fetch 24h data
                const response24h = await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${symbol}`);
                const data24h = await response24h.json();
                
                // Fetch 1h kline data
                const oneHourAgo = Date.now() - (60 * 60 * 1000);
                const response1h = await fetch(
                    `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1m&startTime=${oneHourAgo}&limit=60`
                );
                const data1h = await response1h.json();
                
                const row = document.querySelector(`tr[data-symbol="${symbol}"]`);
                if (!row) return;

                // Update price
                row.querySelector('.price').textContent = 
                    parseFloat(data24h.lastPrice).toLocaleString('en-US', {
                        style: 'currency',
                        currency: 'USD'
                    });

                // Calculate 1h change
                if (data1h && data1h.length > 0) {
                    const startPrice1h = parseFloat(data1h[0][1]); // Open price of first candle
                    const currentPrice = parseFloat(data24h.lastPrice);
                    const priceChange1h = ((currentPrice - startPrice1h) / startPrice1h) * 100;
                    
                    const change1hCell = row.querySelector('.change-1h');
                    change1hCell.textContent = `${priceChange1h.toFixed(1)}%`;
                    change1hCell.className = `change-1h ${priceChange1h >= 0 ? 'positive' : 'negative'}`;
                }

                // Update 24h change
                const priceChange24h = parseFloat(data24h.priceChangePercent);
                const change24hCell = row.querySelector('.change-24h');
                change24hCell.textContent = `${priceChange24h.toFixed(1)}%`;
                change24hCell.className = `change-24h ${priceChange24h >= 0 ? 'positive' : 'negative'}`;
            } catch (error) {
                console.error(`Error fetching current price for ${symbol}:`, error);
            }
        }

        // Fetch historical data and update the table
        async function fetchHistoricalData(symbol) {
            try {
                // Fetch 7d data
                const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);
                const weekResponse = await fetch(
                    `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1d&startTime=${sevenDaysAgo}`
                );
                const weekData = await weekResponse.json();

                // Fetch 30d data
                const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
                const monthResponse = await fetch(
                    `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1d&startTime=${thirtyDaysAgo}`
                );
                const monthData = await monthResponse.json();

                // Fetch 90d data
                const ninetyDaysAgo = Date.now() - (90 * 24 * 60 * 60 * 1000);
                const quarterResponse = await fetch(
                    `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1d&startTime=${ninetyDaysAgo}`
                );
                const quarterData = await quarterResponse.json();

                const row = document.querySelector(`tr[data-symbol="${symbol}"]`);
                if (!row) return;

                // Calculate and update 7d change
                const sevenDayChange = ((weekData[weekData.length - 1][4] - weekData[0][1]) / weekData[0][1]) * 100;
                const change7dCell = row.querySelector('.change-7d');
                change7dCell.textContent = `${sevenDayChange.toFixed(1)}%`;
                change7dCell.className = `change-7d ${sevenDayChange >= 0 ? 'positive' : 'negative'}`;

                // Calculate and update 30d change
                const thirtyDayChange = ((monthData[monthData.length - 1][4] - monthData[0][1]) / monthData[0][1]) * 100;
                const change30dCell = row.querySelector('.change-30d');
                change30dCell.textContent = `${thirtyDayChange.toFixed(1)}%`;
                change30dCell.className = `change-30d ${thirtyDayChange >= 0 ? 'positive' : 'negative'}`;

                // Calculate and update 90d change
                const ninetyDayChange = ((quarterData[quarterData.length - 1][4] - quarterData[0][1]) / quarterData[0][1]) * 100;
                const change90dCell = row.querySelector('.change-90d');
                change90dCell.textContent = `${ninetyDayChange.toFixed(1)}%`;
                change90dCell.className = `change-90d ${ninetyDayChange >= 0 ? 'positive' : 'negative'}`;
            } catch (error) {
                console.error(`Error fetching historical data for ${symbol}:`, error);
            }
        }

        // Calculate RSI
        function calculateRSI(prices, period = 14) {
            let gains = [];
            
            let losses = [];
            
            // Calculate price changes
            for(let i = 1; i < prices.length; i++) {
                const change = prices[i] - prices[i-1];
                gains.push(change >= 0 ? change : 0);
                losses.push(change < 0 ? Math.abs(change) : 0);
            }
            
            // Calculate average gains and losses
            let avgGain = gains.slice(0, period).reduce((a, b) => a + b) / period;
            let avgLoss = losses.slice(0, period).reduce((a, b) => a + b) / period;
            
            const rsi = [100 - (100 / (1 + avgGain / avgLoss))];
            
            // Calculate RSI for remaining periods
            for(let i = period; i < prices.length - 1; i++) {
                avgGain = (avgGain * (period - 1) + gains[i]) / period;
                avgLoss = (avgLoss * (period - 1) + losses[i]) / period;
                rsi.push(100 - (100 / (1 + avgGain / avgLoss)));
            }
            
            return rsi;
        }

        // Calculate EMA
        function calculateEMA(prices, period) {
            const multiplier = 2 / (period + 1);
            let ema = [prices[0]];
            
            for(let i = 1; i < prices.length; i++) {
                ema.push((prices[i] - ema[i-1]) * multiplier + ema[i-1]);
            }
            
            return ema;
        }

        // Calculate MACD
        function calculateMACD(prices) {
            const ema12 = calculateEMA(prices, 12);
            const ema26 = calculateEMA(prices, 26);
            
            // Calculate MACD line
            const macdLine = ema12.map((value, index) => value - ema26[index]);
            
            // Calculate signal line (9-day EMA of MACD)
            const signalLine = calculateEMA(macdLine, 9);
            
            return {
                MACD: macdLine,
                signal: signalLine
            };
        }

        // Calculate Stochastic Oscillator
        function calculateStochastic(highs, lows, closes, period = 14) {
            let stochK = [];
            let stochD = [];
            
            for (let i = period - 1; i < closes.length; i++) {
                const highestHigh = Math.max(...highs.slice(i - period + 1, i + 1));
                const lowestLow = Math.min(...lows.slice(i - period + 1, i + 1));
                const currentClose = closes[i];
                
                const k = ((currentClose - lowestLow) / (highestHigh - lowestLow)) * 100;
                stochK.push(k);
            }
            
            // Calculate %D (3-period SMA of %K)
            for (let i = 2; i < stochK.length; i++) {
                const d = (stochK[i] + stochK[i-1] + stochK[i-2]) / 3;
                stochD.push(d);
            }
            
            return {
                k: stochK[stochK.length - 1],
                d: stochD[stochD.length - 1]
            };
        }

        // Calculate Bollinger Bands
        function calculateBollingerBands(prices, period = 20, multiplier = 2) {
            const sma = prices.slice(prices.length - period).reduce((a, b) => a + b) / period;
            const squaredDiffs = prices.slice(prices.length - period).map(price => Math.pow(price - sma, 2));
            const standardDeviation = Math.sqrt(squaredDiffs.reduce((a, b) => a + b) / period);
            
            return {
                middle: sma,
                upper: sma + (multiplier * standardDeviation),
                lower: sma - (multiplier * standardDeviation)
            };
        }

        // Cache object for technical analysis results
        const taCache = new Map();

        // Modified calculateTechnicalAnalysis function
        async function calculateTechnicalAnalysis(symbol, period = '7d') {
            const cacheKey = `${symbol}-${period}`;
            
            // Check cache first
            if (taCache.has(cacheKey)) {
                const cachedData = taCache.get(cacheKey);
                // Use cache if it's less than 5 minutes old
                if (Date.now() - cachedData.timestamp < 5 * 60 * 1000) {
                    return updateTADisplay(symbol, cachedData.data, period);
                }
            }

            console.log(`Calculating ${period} technical analysis for ${symbol}`);
            
            try {
                // Calculate time range based on period
                let startTime, interval;
                switch(period) {
                    case '1h':
                        startTime = Date.now() - (60 * 60 * 1000);
                        interval = '1m';
                        break;
                    case '24h':
                        startTime = Date.now() - (24 * 60 * 60 * 1000);
                        interval = '15m';
                        break;
                    case '7d':
                        startTime = Date.now() - (7 * 24 * 60 * 60 * 1000);
                        interval = '1h';
                        break;
                    case '30d':
                        startTime = Date.now() - (30 * 24 * 60 * 60 * 1000);
                        interval = '4h';
                        break;
                    case '90d':
                        startTime = Date.now() - (90 * 24 * 60 * 60 * 1000);
                        interval = '12h';
                        break;
                }

                const response = await fetch(
                    `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&startTime=${startTime}`
                );
                const data = await response.json();
                
                if (!data || data.length === 0) {
                    console.error(`No data received for ${symbol}`);
                    return;
                }

                // Calculate indicators
                const closes = data.map(candle => parseFloat(candle[4]));
                const highs = data.map(candle => parseFloat(candle[2]));
                const lows = data.map(candle => parseFloat(candle[3]));

                const rsi = calculateRSI(closes, 14);
                const macdResult = calculateMACD(closes);
                const ema20 = calculateEMA(closes, 20);
                const stoch = calculateStochastic(highs, lows, closes, 14);
                const bb = calculateBollingerBands(closes, 20);

                const result = {
                    rsi: rsi[rsi.length - 1],
                    macd: macdResult.MACD[macdResult.MACD.length - 1],
                    signal: macdResult.signal[macdResult.signal.length - 1],
                    ema: ema20[ema20.length - 1],
                    price: closes[closes.length - 1],
                    stochK: stoch.k,
                    stochD: stoch.d,
                    bbUpper: bb.upper,
                    bbLower: bb.lower,
                    bbMiddle: bb.middle
                };

                // Cache the result
                taCache.set(cacheKey, {
                    timestamp: Date.now(),
                    data: result
                });

                return updateTADisplay(symbol, result, period);
            } catch (error) {
                console.error(`Error calculating technical analysis for ${symbol}:`, error);
            }
        }

        // Function to update TA display
        function updateTADisplay(symbol, data, period) {
            const row = document.querySelector(`tr[data-symbol="${symbol}"]`);
            if (!row) return;

            let signals = {
                rsi: 'NEUTRAL',
                macd: 'NEUTRAL',
                ema: 'NEUTRAL',
                stoch: 'NEUTRAL',
                bb: 'NEUTRAL',
                overall: 'NEUTRAL',
                bullishCount: 0,
                bearishCount: 0
            };

            // RSI Analysis
            if (data.rsi > 70) {
                signals.rsi = 'BEARISH';
            } else if (data.rsi < 30) {
                signals.rsi = 'BULLISH';
            }

            // MACD Analysis
            signals.macd = data.macd > data.signal ? 'BULLISH' : 'BEARISH';

            // EMA Analysis
            signals.ema = data.price > data.ema ? 'BULLISH' : 'BEARISH';

            // Stochastic Oscillator Analysis
            if (data.stochK > 80) {
                signals.stoch = 'BEARISH';
            } else if (data.stochK < 20) {
                signals.stoch = 'BULLISH';
            }

            // Bollinger Bands Analysis
            if (data.price > data.bbUpper) {
                signals.bb = 'BEARISH';
            } else if (data.price < data.bbLower) {
                signals.bb = 'BULLISH';
            }

            // Count signals
            signals.bullishCount = [
                signals.rsi === 'BULLISH' ? 1 : 0,
                signals.macd === 'BULLISH' ? 1 : 0,
                signals.ema === 'BULLISH' ? 1 : 0,
                signals.stoch === 'BULLISH' ? 1 : 0,
                signals.bb === 'BULLISH' ? 1 : 0
            ].reduce((a, b) => a + b, 0);

            signals.bearishCount = [
                signals.rsi === 'BEARISH' ? 1 : 0,
                signals.macd === 'BEARISH' ? 1 : 0,
                signals.ema === 'BEARISH' ? 1 : 0,
                signals.stoch === 'BEARISH' ? 1 : 0,
                signals.bb === 'BEARISH' ? 1 : 0
            ].reduce((a, b) => a + b, 0);

            // Determine overall signal
            if (signals.bullishCount > signals.bearishCount) {
                signals.overall = 'BULLISH';
            } else if (signals.bearishCount > signals.bullishCount) {
                signals.overall = 'BEARISH';
            }

            // Update the signal in the main row
            const detailsDiv = row.querySelector(`.indicator-details[data-period="${period}"]`);
            if (detailsDiv) {
                detailsDiv.innerHTML = `<span class="signal ${signals.overall.toLowerCase()}">${signals.overall}</span>`;
                detailsDiv.dataset.technicalDetails = JSON.stringify({
                    symbol,
                    period,
                    data,
                    signals
                });
            }
        }

        // Function to show technical details popup
        function showTechnicalDetails(element) {
            const details = JSON.parse(element.dataset.technicalDetails);
            const { symbol, period, data, signals } = details;
            
            const popup = document.querySelector('.technical-details-popup');
            const overlay = document.querySelector('.overlay');
            const header = popup.querySelector('.popup-header h3');
            const content = popup.querySelector('.popup-content');
            const closeButton = popup.querySelector('.close-button');

            // Set header
            const symbolName = element.closest('tr').querySelector('.name-cell').textContent.trim();
            header.textContent = `${symbolName} - ${getPeriodName(period)}`;

            // Set content
            content.innerHTML = `
                <div class="summary-section">
                    <div class="overall-signal">
                        <span class="signal-label">Overall Signal:</span>
                        <span class="signal ${signals.overall.toLowerCase()}">${signals.overall}</span>
                    </div>
                    <div class="signal-counts">
                        <div class="bullish-count">
                            <span class="count-label">Bullish signals:</span>
                            <span class="count">${signals.bullishCount}</span>
                        </div>
                        <div class="bearish-count">
                            <span class="count-label">Bearish signals:</span>
                            <span class="count">${signals.bearishCount}</span>
                        </div>
                    </div>
                </div>

                <div class="indicators-section">
                    <div class="tooltip-section">
                        <h4>RSI (Relative Strength Index)</h4>
                        <div class="indicator-row">
                            <span class="value-label">Value: ${data.rsi.toFixed(2)}</span>
                            <span class="signal ${signals.rsi.toLowerCase()}">${signals.rsi}</span>
                        </div>
                        <p class="indicator-desc">Measures momentum. Above 70 is overbought (bearish), below 30 is oversold (bullish).</p>
                    </div>

                    <div class="tooltip-section">
                        <h4>MACD</h4>
                        <div class="indicator-row">
                            <span class="value-label">MACD: ${data.macd.toFixed(6)}</span>
                            <span class="signal ${signals.macd.toLowerCase()}">${signals.macd}</span>
                        </div>
                        <p class="indicator-desc">Trend indicator. MACD above Signal line is bullish, below is bearish.</p>
                    </div>

                    <div class="tooltip-section">
                        <h4>EMA (20)</h4>
                        <div class="indicator-row">
                            <span class="value-label">Price vs EMA</span>
                            <span class="signal ${signals.ema.toLowerCase()}">${signals.ema}</span>
                        </div>
                        <p class="indicator-desc">Trend indicator. Price above EMA is bullish, below is bearish.</p>
                    </div>

                    <div class="tooltip-section">
                        <h4>Stochastic Oscillator</h4>
                        <div class="indicator-row">
                            <span class="value-label">%K: ${data.stochK.toFixed(2)} | %D: ${data.stochD.toFixed(2)}</span>
                            <span class="signal ${signals.stoch.toLowerCase()}">${signals.stoch}</span>
                        </div>
                        <p class="indicator-desc">Momentum indicator. Above 80 is overbought, below 20 is oversold.</p>
                    </div>

                    <div class="tooltip-section">
                        <h4>Bollinger Bands</h4>
                        <div class="indicator-row">
                            <span class="value-label">Price: ${data.price.toFixed(2)}</span>
                            <span class="signal ${signals.bb.toLowerCase()}">${signals.bb}</span>
                        </div>
                        <p class="indicator-desc">Volatility indicator. Price above upper band suggests overbought, below lower band suggests oversold.</p>
                    </div>
                </div>
            `;

            // Show popup and overlay
            popup.style.display = 'block';
            overlay.style.display = 'block';
            
            // Add active class for animation and lock body scroll
            requestAnimationFrame(() => {
                popup.classList.add('active');
                overlay.classList.add('active');
                document.body.classList.add('popup-open');
            });

            // Close popup handler
            const closePopup = () => {
                popup.classList.remove('active');
                overlay.classList.remove('active');
                document.body.classList.remove('popup-open');
                setTimeout(() => {
                    popup.style.display = 'none';
                    overlay.style.display = 'none';
                }, 300);
            };

            // Add click handlers for close button and overlay
            closeButton.onclick = closePopup;
            overlay.onclick = closePopup;

            // Handle escape key
            document.addEventListener('keydown', function escapeHandler(e) {
                if (e.key === 'Escape') {
                    closePopup();
                    document.removeEventListener('keydown', escapeHandler);
                }
            });
        }

        // Helper function to get period name
        function getPeriodName(period) {
            switch(period) {
                case '1h': return 'Very Short Term (1h)';
                case '24h': return 'Short Term (24h)';
                case '7d': return 'Mid Term (7d)';
                case '30d': return 'Long Term (30d)';
                default: return period;
            }
        }

        // Initialize click handlers for technical indicators and popup
        function initializeHandlers() {
            // Technical indicator click handlers
            document.querySelectorAll('.indicator-details').forEach(indicator => {
                indicator.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent row click
                    showTechnicalDetails(indicator);
                });
            });

            // Close popup handlers
            const popup = document.querySelector('.technical-details-popup');
            const overlay = document.querySelector('.overlay');
            const closeBtn = document.querySelector('.close-button');

            [closeBtn, overlay].forEach(element => {
                element.addEventListener('click', () => {
                    popup.classList.remove('active');
                    setTimeout(() => {
                        popup.style.display = 'none';
                        overlay.style.display = 'none';
                    }, 300);
                });
            });
        }

        // Initialize handlers after DOM content is loaded
        document.addEventListener('DOMContentLoaded', initializeHandlers);

        // Add initialization to updateData function
        async function updateData() {
            for (const symbol of symbols) {
                try {
                    await fetchCurrentPrice(symbol);
                    await fetchHistoricalData(symbol);
                    await calculateTechnicalAnalysis(symbol, '1h');
                    await calculateTechnicalAnalysis(symbol, '24h');
                    await calculateTechnicalAnalysis(symbol, '7d');
                    await calculateTechnicalAnalysis(symbol, '30d');
                } catch (error) {
                    console.error(`Error updating data for ${symbol}:`, error);
                }
            }
            // Re-initialize handlers after data update
            initializeHandlers();
        }

        // Add refresh button functionality
        document.getElementById('refreshButton').addEventListener('click', async () => {
            const button = document.getElementById('refreshButton');
            const lastUpdate = document.getElementById('lastUpdate');
            
            // Disable button during refresh
            button.disabled = true;
            button.textContent = 'Refreshing...';
            
            // Update the data
            await updateData();
            
            // Update timestamp and reset button
            lastUpdate.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
            button.disabled = false;
            button.textContent = 'Refresh Data';
        });

        // Add some CSS for the refresh button
        const style = document.createElement('style');
        style.textContent = `
            .refresh-btn {
                padding: 8px 16px;
                background-color: #1a1a1a;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
            }
            
            .refresh-btn:hover {
                background-color: #333;
            }
            
            .refresh-btn:disabled {
                background-color: #666;
                cursor: not-allowed;
            }
        `;
        document.head.appendChild(style);

        // Initial load
        updateData().then(() => {
            document.getElementById('lastUpdate').textContent = 
                `Last updated: ${new Date().toLocaleTimeString()}`;
        });

        // Add this function right before the sorting initialization
        function getCellValue(tr, idx) {
            const cell = tr.children[idx];
            if (!cell) return '';
            
            // For price column, remove currency symbol and parse as number
            if (idx === 1) {
                return parseFloat(cell.textContent.replace(/[$,]/g, '')) || 0;
            }
            // For percentage columns, remove % and parse as number
            if (idx >= 2 && idx <= 6) {
                return parseFloat(cell.textContent.replace('%', '')) || 0;
            }
            // For technical analysis columns (1h TA, Short, Mid, Long)
            if (idx >= 7 && idx <= 10) {
                const signalElement = cell.querySelector('.signal');
                if (!signalElement) return -1;
                
                const signal = signalElement.textContent.trim();
                // Define order: BULLISH > NEUTRAL > BEARISH > Loading...
                const signalOrder = {
                    'BULLISH': 3,
                    'NEUTRAL': 2,
                    'BEARISH': 1,
                    'Loading...': 0
                };
                return signalOrder[signal] || 0;
            }
            return cell.textContent;
        }

        function comparer(idx, asc) {
            return function(a, b) {
                const valA = getCellValue(asc ? a : b, idx);
                const valB = getCellValue(asc ? b : a, idx);
                
                // Handle numeric comparison
                if (!isNaN(valA) && !isNaN(valB)) {
                    return valA - valB;
                }
                
                // Handle string comparison
                return valA.toString().localeCompare(valB.toString());
            };
        }

        // Initialize sorting functionality
        document.querySelectorAll('th').forEach(th => {
            const index = Array.from(th.parentElement.children).indexOf(th);
            if (index > 0) {  // Allow sorting for all columns except the first one
                th.addEventListener('click', () => {
                    const tbody = th.closest('table').querySelector('tbody');
                    // Only select main token rows (those with data-symbol attribute that doesn't end with -details)
                    const rows = Array.from(tbody.querySelectorAll('tr[data-symbol]:not([data-symbol$="-details"])'));
                    
                    document.querySelectorAll('th').forEach(header => {
                        header.textContent = header.textContent.replace(' ↑', '').replace(' ↓', '');
                    });

                    const currentIsAscending = th.classList.contains('th-sort-asc');
                    rows.sort(comparer(index, !currentIsAscending));
                    
                    // Reorder rows while maintaining the technical details rows after their respective token rows
                    rows.forEach(tr => {
                        tbody.appendChild(tr);
                        const detailsRow = tbody.querySelector(`tr[data-symbol="${tr.getAttribute('data-symbol')}-details"]`);
                        if (detailsRow) {
                            tbody.appendChild(detailsRow);
                        }
                    });

                    th.textContent = th.textContent + (currentIsAscending ? ' ↓' : ' ↑');
                    th.classList.toggle('th-sort-asc', !currentIsAscending);
                    th.classList.toggle('th-sort-desc', currentIsAscending);
                });
            }
        });
    </script>
</body>
</html> 